<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Welcome Home</title>
</head>
<body style="font-family: Verdana; font-size: 9pt;">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
<script type="text/javascript">

var alarm = 'off';
var alarmPartial = 'off';

var count = 20;
function progress() {
	var progressString = '';
	for (i = 1; i < count; i++) {
		progressString += '.';
	}
	$('#progress').text(progressString);
	count --;	
	if (count == 0) {
		updateAll();
		count = 20;		
	}
}


function updateAll() {
	// Show status indicator
	$('#loader').show();
	
	// Alarm settings
	$.getJSON('./rest/knxservice/group', {'address' : '0/1/0'}, function(json) {
		$('#al_woning_voll').text(json.value);
		alarm = json.value;
	});
	$.getJSON('./rest/knxservice/group', {'address' : '0/1/1'}, function(json) {
		$('#al_woning_ged').text(json.value);
		alarmPartial = json.value;
	});
	$.getJSON('./rest/knxservice/group', {'address' : '0/1/3'}, function(json) {
		$('#al_brand').text(json.value);
	});
	$.getJSON('./rest/knxservice/group', {'address' : '0/1/4'}, function(json) {
		$('#al_alarm').text(json.value);
	});
	
	
	// lights	
	$.getJSON('./rest/knxservice/group', {'address' : '1/4/38'}, function(json) {
		$('#licht_wasplaats').text(json.value);
	});

	$.getJSON('./rest/knxservice/group', {'address' : '1/4/27'}, function(json) {
		$('#licht_mb_gang').text(json.value);
	});	
	$.getJSON('./rest/knxservice/group', {'address' : '1/4/26'}, function(json) {
		$('#licht_mb_centraal').text(json.value);
	});		
	
	$.getJSON('./rest/knxservice/group', {'address' : '1/4/19'}, function(json) {
		$('#licht_bt_bureau').text(json.value);
	});	
	$.getJSON('./rest/knxservice/group', {'address' : '1/4/20'}, function(json) {
		$('#licht_bt_vooraan').text(json.value);
	});

	// Shutters
	$.getJSON('./rest/knxservice/group', {'address' : '3/3/0'}, function(json) {
		$('#shutter_mb').text(json.value);
	});		
	$.getJSON('./rest/knxservice/group', {'address' : '3/3/1'}, function(json) {
		$('#shutter_kamer1').text(json.value);
	});	
	$.getJSON('./rest/knxservice/group', {'address' : '3/3/2'}, function(json) {
		$('#shutter_kamer2').text(json.value);
	});	
	
	// heating
	$.getJSON('./rest/knxservice/group', {'address' : '2/1/0'}, function(json) {
		$('#temp_living').text(json.value + ' °C');
	});
	$.getJSON('./rest/knxservice/group', {'address' : '2/2/0'}, function(json) {
		$('#settemp_living').text(json.value + ' °C');
	});
	
	$.getJSON('./rest/knxservice/group', {'address' : '2/1/1'}, function(json) {
		$('#temp_bureau_marlies').text(json.value + ' °C');
	});	
	$.getJSON('./rest/knxservice/group', {'address' : '2/2/1'}, function(json) {
		$('#settemp_bureau_marlies').text(json.value + ' °C');
	});	

	$.getJSON('./rest/knxservice/group', {'address' : '2/1/2'}, function(json) {
		$('#temp_wasplaats').text(json.value + ' °C');
	});	
	$.getJSON('./rest/knxservice/group', {'address' : '2/2/2'}, function(json) {
		$('#settemp_wasplaats').text(json.value + ' °C');
	});	

	$.getJSON('./rest/knxservice/group', {'address' : '2/1/3'}, function(json) {
		$('#temp_entertain').text(json.value + ' °C');
	});
	$.getJSON('./rest/knxservice/group', {'address' : '2/2/3'}, function(json) {
		$('#settemp_entertain').text(json.value + ' °C');
	});		
	
	$.getJSON('./rest/knxservice/group', {'address' : '2/1/4'}, function(json) {
		$('#temp_kamer1').text(json.value + ' °C');
	});		
	$.getJSON('./rest/knxservice/group', {'address' : '2/2/4'}, function(json) {
		$('#settemp_kamer1').text(json.value + ' °C');
	});
	
	$.getJSON('./rest/knxservice/group', {'address' : '2/1/5'}, function(json) {
		$('#temp_douche').text(json.value + ' °C');
	});	
	$.getJSON('./rest/knxservice/group', {'address' : '2/2/5'}, function(json) {
		$('#settemp_douche').text(json.value + ' °C');
	});	
	
	$.getJSON('./rest/knxservice/group', {'address' : '2/1/6'}, function(json) {
		$('#temp_kamer2').text(json.value + ' °C');
	});	
	$.getJSON('./rest/knxservice/group', {'address' : '2/2/6'}, function(json) {
		$('#settemp_kamer2').text(json.value + ' °C');
	});	
	
	$.getJSON('./rest/knxservice/group', {'address' : '2/1/7'}, function(json) {
		$('#temp_bureau_tom').text(json.value + ' °C');
	});	
	$.getJSON('./rest/knxservice/group', {'address' : '2/2/7'}, function(json) {
		$('#settemp_bureau_tom').text(json.value + ' °C');
	});	

	$.getJSON('./rest/knxservice/group', {'address' : '2/1/8'}, function(json) {
		$('#temp_masterbed').text(json.value + ' °C');
	});	
	$.getJSON('./rest/knxservice/group', {'address' : '2/2/8'}, function(json) {
		$('#settemp_masterbed').text(json.value + ' °C');
	});		
	
	$.getJSON('./rest/knxservice/group', {'address' : '2/1/9'}, function(json) {
		$('#temp_badkamer').text(json.value + ' °C');
	});	
	$.getJSON('./rest/knxservice/group', {'address' : '2/2/9'}, function(json) {
		$('#settemp_badkamer').text(json.value + ' °C');
	});	
	
	$.getJSON('./rest/knxservice/group', {'address' : '2/6/1'}, function(json) {
		$('#temp_buiten').text(json.value + ' °C');
	});	
	
	// Heating required?
	$.getJSON('./rest/knxservice/group', {'address' : '2/0/4'}, function(json) {
		if (json.value == 'on') {
			$('#verwarming').css('background-color', 'red');
		} else {
			$('#verwarming').css('background-color', 'transparent');
		}

	});	
	
	$.getJSON('./rest/knxservice/state', function(json) {
		$('#state').text(json.value);
	});		
	$.getJSON('./rest/knxservice/lastconnect', function(json) {
		$('#lastconnect').text(json.value);
	});			
	
	// Hide status indicator
	$('#loader').hide();	
}

// temp variable.
var heatingState = 1

$(document).ready(function(){
	updateAll();
	// tick every second... see progress() funtion for details.
	setInterval(function(){ progress()}, 1 * 1000);
	
	$("#poort").click(function() {
		$.ajax({
			type: "POST",
			url: "./rest/knxservice/group",
			data: "{'address': '4/0/0','boolean': true}",
			contentType: "application/json",
			processData: false
		});
		setInterval(
			$.ajax({
				type: "POST",
				url: "./rest/knxservice/group",
				data: "{'address': '4/0/0','boolean': false}",
				contentType: "application/json",
				processData: false
			}),
			250); // end setInterval		
	});
	
	// 0: Auto
	// 1: Comfort
	// 2: Stand-by
	// 4: Frost Protection	
	$("#verwarming").click(function() {		
			$.ajax({
				type: "POST",
				url: "./rest/knxservice/group",
				data: "{'address': '2/4/0','int': '1'}",
				contentType: "application/json",
				processData: false
			});	
	});	
	
	$("#logon").click(function() {		
		$.ajax({
			type: "POST",
			url: "./rest/knxservice/log",
			data: "{'level': 'finer'}",
			contentType: "application/json",
			processData: false
		});	
	});
	
	$("#logoff").click(function() {		
		$.ajax({
			type: "POST",
			url: "./rest/knxservice/log",
			data: "{'level': 'info'}",
			contentType: "application/json",
			processData: false
		});	
	});		
	
	var Chat = {};
	Chat.socket = null;
	
	Chat.connect = (function(host) {
		Chat.socket = new WebSocket(host);

		Chat.socket.onopen = function () {
			$('#ws').text("CONNECTED");
		}
	
		Chat.socket.onclose = function () {
			$('#ws').text("CLOSED");
		}
		
		Chat.socket.onerror = function (event) {			
			$('#ws').text("ERROR");
		}
	
		Chat.socket.onmessage = function (message) {
			$('#ws').text(message.data);
		}
	
	});		
		
	Chat.initialize = function() {
		// Some magic to find the right path name
		var pathArray = window.location.pathname.split('/');
		var newPathname = "";
		for ( i = 0; i < pathArray.length -1 ; i++ ) { // don't include the last part (which is index.html)
		  newPathname += pathArray[i];
		  newPathname += "/";		  
		}
	
		var url = 'wss://' + window.location.host + newPathname + 'ws';
		Chat.connect(url);
	};
	
	Chat.sendMessage = (function(msg) {
		Chat.socket.send(msg);
	});
			
	Chat.initialize();
	
	$("#ws").click(function() {
		var date = new Date();
		Chat.sendMessage('' + date);
	});			
	
});


</script>
<div style="float: right;text-align: right;">
	<br /><br />
	<span id="poort">Poort</span><br />
	<br />
	<br />
	<span id="verwarming">Verwarming living</span><br />
	<br />
	<br />
	<span id="state"></span><br />
	KNX last connect: <span id="lastconnect">---</span><br />
	<br />
	Log: <span id="logon">on</span> / <span id="logoff">off</span><br />
	<br />
	WS: <span id="ws">...</span><br />
	
</div>

<img id="loader" src="./img/ajax-loader.gif" style="position: fixed; top: 10px; left: 20px;">

Alarm <br />
* Woning volledig: <span id="al_woning_voll"></span><br />
* Woning gedeeltelijk: <span id="al_woning_ged"></span><br />
* Brand!: <span id="al_brand"></span><br />
* Alarm!: <span id="al_alarm"></span><br />
<br />
Wasplaats<br />
* Temp: <span id="temp_wasplaats"></span> / <span id="settemp_wasplaats"></span><br />
* Licht: <span id="licht_wasplaats"></span><br />
<br />
Entertainment kamer<br />
* Temp: <span id="temp_entertain"></span> / <span id="settemp_entertain"></span><br />
<br />
Living <br />
* Temp: <span id="temp_living"></span> / <span id="settemp_living"></span><br />
<br />
Bureau Marlies<br />
* Temp: <span id="temp_bureau_marlies"></span> / <span id="settemp_bureau_marlies"></span><br />
<br />
Kamer 1<br />
* Temp: <span id="temp_kamer1"></span> / <span id="settemp_kamer1"></span><br />
* Rolluik: <span id="shutter_kamer1"></span> (% gesloten)<br /> 
<br />
Kamer 2<br />
* Temp: <span id="temp_kamer2"></span> / <span id="settemp_kamer2"></span><br />
* Rolluik: <span id="shutter_kamer2"></span> (% gesloten)<br /> 
<br />
Douche<br />
* Temp: <span id="temp_douche"></span> / <span id="settemp_douche"></span><br />
<br />
Masterbedroom<br />
* Temp: <span id="temp_masterbed"></span> / <span id="settemp_masterbed"></span><br />
* Rolluik: <span id="shutter_mb"></span> (% gesloten)<br /> 
* Licht centraal: <span id="licht_mb_centraal"></span><br />
* Licht gang: <span id="licht_mb_gang"></span><br />
<br />
Badkamer<br />
* Temp: <span id="temp_badkamer"></span> / <span id="settemp_badkamer"></span><br />
<br />
Bureau Tom<br />
* Temp: <span id="temp_bureau_tom"></span> / <span id="settemp_bureau_tom"></span><br />
* Licht - vooraan: <span id="licht_bt_vooraan"></span><br />
* Licht - bureau: <span id="licht_bt_bureau"></span><br />
<br />
<br />
Buiten:<br />
* Temp: <span id="temp_buiten"></span><br />
<br />
<div id="progress"></div>
</body>
</html>